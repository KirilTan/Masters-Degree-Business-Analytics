# ==============================================================================
# Задача 3 — Класификационен модел с Quadratic Discriminant Analysis (QDA) върху Iris
#
# Изисквания:
# - Да се използва множеството Iris от scikit-learn
# - Да се направи 6-fold KFold (с разбъркване)
# - Да се дефинират 3 нови наблюдения и да се предскаже класът им
# - Да се добави визуализация
# ==============================================================================

# ================================================================================
# 0) Импорт на нужните библиотеки
# ================================================================================
from sklearn.datasets import load_iris
from sklearn.discriminant_analysis import QuadraticDiscriminantAnalysis
from sklearn.model_selection import KFold, cross_val_score
import numpy as np
import matplotlib.pyplot as plt

# ==============================================================================
# 1) Зареждане на Iris
# ==============================================================================
iris = load_iris()
X = iris.data
y = iris.target

# ==============================================================================
# 2) Дефиниране на модела QDA
# ------------------------------------------------------------------------------
# QDA допуска различни ковариационни матрици за всеки клас (по-гъвкав от LDA).
# ==============================================================================
qda_model = QuadraticDiscriminantAnalysis()

# ==============================================================================
# 3) 6-fold KFold + Cross-Validation
# ------------------------------------------------------------------------------
# Разделяме данните на 6 части (folds) и оценяваме accuracy във всеки fold.
# shuffle=True + random_state=42
# ==============================================================================
kf = KFold(n_splits=6, shuffle=True, random_state=42)

scores = cross_val_score(qda_model, X, y, cv=kf, scoring='accuracy')

print("Accuracy for each fold:", scores)
print("Mean accuracy:", np.mean(scores))

# ==============================================================================
# 4) Обучение на модела върху всички данни
# ==============================================================================
qda_model.fit(X, y)

# ==============================================================================
# 5) Дефиниране на 3 нови наблюдения + предсказване на клас
# ------------------------------------------------------------------------------
# Форматът на всяко наблюдение е:
# [sepal length, sepal width, petal length, petal width]
# ==============================================================================
new_samples = np.array([
    [5.1, 3.5, 1.4, 0.2],
    [6.0, 2.9, 4.5, 1.5],
    [6.9, 3.1, 5.4, 2.1]
])

predictions = qda_model.predict(new_samples)
predicted_classes = [iris.target_names[i] for i in predictions]

print("Predicted classes for the new samples:", predicted_classes)

# ==============================================================================
# 6) Визуализация (2D scatter) + нови наблюдения
# ------------------------------------------------------------------------------
# Показваме данните в 2D (Sepal Length срещу Sepal Width), оцветени по клас.
# Новите наблюдения се показват като черни "X".
# ==============================================================================
plt.figure(figsize=(8, 6))
colors = ['red', 'green', 'blue']

for i, color in enumerate(colors):
    plt.scatter(
        X[y == i, 0], X[y == i, 1],
        label=iris.target_names[i],
        alpha=0.6
    )

plt.scatter(
    new_samples[:, 0], new_samples[:, 1],
    c='black', s=100, marker='X',
    label='New Samples'
)

plt.xlabel('Sepal Length')
plt.ylabel('Sepal Width')
plt.title('QDA on Iris Dataset')
plt.legend()
plt.show()
